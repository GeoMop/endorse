#!/bin/bash
# This would create a development virtual environment
# - uses requirements.txt
# - install endorse itself in development mode.
set -x

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Name of the virtual environment folder
VENV_DIR="$SCRIPT_DIR/../venv"

if [ "$1" == "-d" ];
then
    rm -rf "$VENV_DIR"
fi


# Check if virtual environment directory already exists
if [ -d "$VENV_DIR" ]; then
    echo "Virtual environment already exists."
else
    # Create a virtual environment
    python3 -m venv $VENV_DIR
    echo "Virtual environment created."
fi


venv_pip="${VENV_DIR}/bin/pip"
#$venv_pip install wheel
$venv_pip install --upgrade pip

$venv_pip install -r requirements.txt

$venv_pip install -e submodules/bgem
$venv_pip install -e submodules/surrDAMH
$venv_pip install -e submodules/redis-cache

# TODO simplyfy dependency and submodules
# attrs somehow was broken after gmsh explicit installation, must force its reinstalation

$venv_pip install --force-reinstall --upgrade attrs
$venv_pip install -e "${SCRIPT_DIR}/.."






